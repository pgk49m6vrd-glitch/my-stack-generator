name: Close old PRs

on:
  schedule:
    - cron: '55 15 * * *'  # Runs every day at 15:55 UTC

permissions:
  pull-requests: write
  contents: write

jobs:
  close-old-prs:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Close old pull requests
        run: |
          # Fetch all pull requests
          prs=$(gh pr list --json number,updatedAt --jq '\'.updatedAt'')
          for pr in ${prs}; do
            # Check if the PR has been updated in the last 30 days
            if [[ "$(date -d "${pr.updatedAt}" +%s)" -lt "$(date -d '30 days ago' +%s)" ]]; then
              # Close the PR
              gh pr close ${pr.number}
            fi
          done
